#!/bin/bash

if [ ! -f Package.swift ]; then
    echo "File Package.swift does not exist."
    exit 1
fi

if [ -f "$ENV_DIR/BITBUCKET_USER" ]; then
  BITBUCKET_USER=`cat "$ENV_DIR/BITBUCKET_USER"`
fi

if [ -f "$ENV_DIR/BITBUCKET_AUTH_TOKEN" ]; then
  BITBUCKET_AUTH_TOKEN=`cat "$ENV_DIR/BITBUCKET_AUTH_TOKEN"`
fi

if [ -z "$BITBUCKET_USER" ]; then
    echo "BITBUCKET_USER is not set."
    exit 1
fi

if [ -z "$BITBUCKET_AUTH_TOKEN" ]; then
    echo "BITBUCKET_AUTH_TOKEN is not set."
    exit 1
fi

sed -i "s#git@bitbucket\.org:#https://$BITBUCKET_USER:$BITBUCKET_AUTH_TOKEN@bitbucket.org/#g" Package.swift

# New line to echo the contents of Package.swift
echo "Updated Package.swift:"
cat Package.swift
